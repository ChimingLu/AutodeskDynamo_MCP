ç‚ºäº†ç¢ºä¿ AI åœ¨æ§åˆ¶ Autodesk Dynamo æ™‚ä¸ç™¼ç”Ÿä½ç´šéŒ¯èª¤ï¼ˆå¦‚é»åº§æ¨™é‡ç–Šã€èª¤ç”¨ 2D ç¯€é»ç­‰ï¼‰ï¼Œç‰¹è¨‚å®šæ­¤è¦ç¯„ã€‚**AI åœ¨åŸ·è¡Œä»»ä½•ç¹ªåœ–æŒ‡ä»¤å‰å¿…é ˆæª¢æŸ¥æ­¤è¦ç¯„ã€‚**

## 0. å•Ÿå‹•èˆ‡ç‹€æ…‹æª¢æŸ¥ (Startup & Status Check)
- **å¼·åˆ¶åŸ·è¡Œåˆ†æ**ï¼šAI åœ¨é€²è¡Œä»»ä½•å¯¦è³ªä½œæ¥­ï¼ˆæ”¾ç½®ç¯€é»ã€é€£ç·šã€è¼‰å…¥è…³æœ¬ï¼‰å‰ï¼Œ**å¿…é ˆ**å…ˆåŸ·è¡Œ `analyze_workspace` å·¥å…·ã€‚
- **å¹½éˆé€£ç·š (Ghost Listener) åµæ¸¬æ³•**ï¼š
    - **å®šç¾©**ï¼šRevit æœªé—œé–‰ä½†é‡é–‹äº† Dynamo è¦–çª—ã€‚
    - **ç‰¹å¾µ**ï¼šAI åŸ·è¡ŒæŒ‡ä»¤å›å ±æˆåŠŸï¼Œä½†ä½¿ç”¨è€…å›å ±ã€Œæ²’çœ‹åˆ°æ±è¥¿ã€æˆ–ã€Œå·¥ä½œå€æ˜¯ç©ºçš„ã€ã€‚
    - **åˆ¤å®šæº–å‰‡**ï¼šè‹¥ `analyze_workspace` å›å‚³çš„ `nodeCount > 1`ï¼ˆé™¤äº†é€£ç·šç¯€é»ï¼‰ï¼Œä½†ä½¿ç”¨è€…è¡¨ç¤ºæ˜¯æ–°é–‹çš„ç©ºç™½æª”æ¡ˆï¼Œ**åˆ¤å®šç‚ºå¹½éˆé€£ç·š**ã€‚
    - **è™•ç†é‚è¼¯**ï¼šAI å¿…é ˆå¼·åˆ¶åœæ­¢ç•¶å‰æ“ä½œï¼Œå¼•å°ä½¿ç”¨è€…åŸ·è¡Œï¼š`StopMCPServer` -> åˆªé™¤ Stop ç¯€é» -> `StartMCPServer`ã€‚
- **SessionId è®Šå‹•æ„ŸçŸ¥**ï¼š
    - è‹¥ `sessionId` èˆ‡å‰æ¬¡è¨˜éŒ„ä¸ç¬¦ï¼Œè¡¨ç¤º Dynamo ä¼ºæœå™¨å·²é‡æ–°å¯¦ä¾‹åŒ–ã€‚
    - AI å¿…é ˆé‡ç½®å…§éƒ¨ `_nodeIdMap` å¿«å–ï¼Œé¿å…ä½¿ç”¨èˆŠçš„ç¯€é» GUIDã€‚
- **å¼·åˆ¶å›å ±**ï¼šæ¯æ¬¡å°è©±é–‹å§‹æˆ–ç’°å¢ƒè®Šå‹•å¾Œï¼Œ**å¿…é ˆ**ä¸»å‹•å›å ±ï¼š
    - `Workspace Name`: ç•¶å‰æª”æ¡ˆåç¨±ã€‚
    - `Node Count`: ç•¶å‰ç¯€é»æ•¸ã€‚
    - `Session State`: ç¢ºèª Session ID æ˜¯å¦å»¶çºŒæˆ–ç‚ºæ–°å¯¦ä¾‹ã€‚

## 1. ç¯€é»å‰µå»ºçš„æ­£ç¢ºæ–¹æ³• (Critical: Node Creation Method)

### âœ… **å”¯ä¸€æ­£ç¢ºçš„åšæ³•ï¼šä½¿ç”¨å–®ä¸€ Code Block ç¯€é»**
```json
{
    "nodes": [
        {
            "id": "my_geometry",
            "name": "Number",
            "x": 400,
            "y": 400,
            "value": "Line.ByStartPointEndPoint(Point.ByCoordinates(0, 0, 0), Point.ByCoordinates(100, 100, 100));"
        }
    ],
    "connectors": []
}
```

**é—œéµè¦é»**ï¼š
1. **ç¯€é»åç¨±å¿…é ˆæ˜¯ `"Number"`**ï¼ˆä¸æ˜¯ "Code Block"ï¼‰
2. **åœ¨ `value` æ¬„ä½å¯«å®Œæ•´çš„ DesignScript ä»£ç¢¼**
3. **ä»£ç¢¼å¿…é ˆä»¥åˆ†è™Ÿ `;` çµå°¾**
4. **å¯ä»¥åœ¨ä¸€å€‹ Code Block ä¸­å‰µå»ºæ•´å€‹å¹¾ä½•åœ–å½¢**
5. GraphHandler.cs æœƒè‡ªå‹•å°‡ `"Number"` è½‰æ›ç‚º Code Block ç¯€é»

### âŒ **çµ•å°ç¦æ­¢çš„éŒ¯èª¤åšæ³•**
```json
// âŒ éŒ¯èª¤ 1: è©¦åœ–ç›´æ¥å‰µå»º Point.ByCoordinates ç¯€é»
{
    "nodes": [
        {"id": "pt1", "name": "Point.ByCoordinates", "x": 100, "y": 100}
    ]
}

// âŒ éŒ¯èª¤ 2: è©¦åœ–å‰µå»ºå¤šå€‹åˆ†é›¢çš„ Number ç¯€é»ä¸¦é€£æ¥
{
    "nodes": [
        {"id": "x1", "name": "Number", "value": 5, "x": 100, "y": 100},
        {"id": "pt1", "name": "Point.ByCoordinates", "x": 300, "y": 150}
    ],
    "connectors": [{"from": "x1", "to": "pt1", "fromPort": 0, "toPort": 0}]
}

// âŒ éŒ¯èª¤ 3: ä½¿ç”¨ "Code Block" ä½œç‚ºåç¨±
{
    "nodes": [
        {"id": "cb", "name": "Code Block", "code": "...", "x": 100, "y": 100}
    ]
}
```

**ç‚ºä½•é€™äº›æ–¹æ³•æœƒå¤±æ•—**ï¼š
- Dynamo API çš„ `CreateNodeCommand` ç„¡æ³•ç›´æ¥å‰µå»ºå¸¶åƒæ•¸çš„ `Point.ByCoordinates` ç¯€é»
- `Code Block` ä½œç‚ºç¯€é»åç¨±æœƒå°è‡´å‰µå»ºå¤±æ•—
- åˆ†é›¢çš„ç¯€é»å‰µå»ºæœƒå› ç‚º API é™åˆ¶è€Œå¤±æ•—

### ğŸ“‹ **å¯¦æˆ°ç¯„ä¾‹**

**å‰µå»ºä¸€æ¢ç·š**ï¼š
```json
{
    "nodes": [{
        "id": "line1",
        "name": "Number",
        "value": "Line.ByStartPointEndPoint(Point.ByCoordinates(0,0,0), Point.ByCoordinates(100,100,100));",
        "x": 300, "y": 300
    }],
    "connectors": []
}
```

**å‰µå»ºä¸€å€‹ç«‹æ–¹é«”**ï¼š
```json
{
    "nodes": [{
        "id": "cuboid1",
        "name": "Number",
        "value": "Cuboid.ByLengths(Point.ByCoordinates(0,0,0), 10, 10, 10);",
        "x": 300, "y": 300
    }],
    "connectors": []
}
```

**å‰µå»ºè¤‡é›œå¹¾ä½•ï¼ˆå¤šå€‹ Code Blockï¼‰**ï¼š
```json
{
    "nodes": [
        {
            "id": "sphere",
            "name": "Number",
            "value": "Sphere.ByCenterPointRadius(Point.ByCoordinates(0,0,0), 5);",
            "x": 200, "y": 200
        },
        {
            "id": "box",
            "name": "Number",
            "value": "Cuboid.ByLengths(Point.ByCoordinates(20,0,0), 8, 8, 8);",
            "x": 200, "y": 400
        }
    ],
    "connectors": []
}
```

## 2. ç¯€é»é¸ç”¨æº–å‰‡ (Node Selection)
- **æ‹’çµ•æ­§ç¾©**ï¼šåš´ç¦ä½¿ç”¨é»é¸å–®ç°¡ç¨±ï¼ˆå¦‚ `Point.ByCoordinates`ï¼‰ã€‚å¿…é ˆå„ªå…ˆåƒè€ƒ `common_nodes.json` å…§çš„ `fullName`ã€‚
- **Overload è™•ç†è¦å‰‡**ï¼š
    - è‹¥ç™¼ç¾æŸå€‹ç¯€é»å…·å‚™å¤šå€‹é‡è¼‰ï¼ˆOverloadï¼‰ç‰ˆæœ¬ï¼ˆå¦‚ `Point.ByCoordinates` æœ‰ 2D èˆ‡ 3D ç‰ˆæœ¬ï¼‰ï¼Œä¸” AI ç„¡æ³•æ ¹æ“šä¸Šä¸‹æ–‡ç™¾åˆ†ä¹‹ç™¾ç¢ºå®šæ™‚ï¼Œ**ç¦æ­¢**ç›²ç›®å˜—è©¦ã€‚
    - æ­¤æ™‚ **å¿…é ˆ** åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„ Overload é¸é …ï¼Œä¸¦è«‹æ±‚ä½¿ç”¨è€…é¸æ“‡æ­£ç¢ºçš„ç‰ˆæœ¬å¾Œå†ç¹¼çºŒåŸ·è¡Œã€‚
- **å¼·åˆ¶ 3D è­˜åˆ¥**ï¼šè‹¥ç™¼ç¾ `Point.ByCoordinates` è¢«èª¤åˆ¤ç‚º 2D (åƒ… XY)ï¼ŒAI **å¿…é ˆ**æ”¹ç”¨ `Code Block` å¯«å…¥ `Point.ByCoordinates(x, y, z);` ä»¥å¾æ ¹æœ¬ä¸Šä¿è­‰ 3D åŸ ä½ã€‚
- **å…¨è·¯å¾‘å¼•ç”¨**ï¼šç™¼é€æŒ‡ä»¤æ™‚ï¼Œç¯€é»åç¨±æ‡‰ç›¡é‡åŒ…å«å®Œæ•´å‘½åç©ºé–“ã€‚

## 3. æ•¸å€¼è¼¸å…¥æº–å‰‡ (Input Standards)
- **ç¦æ­¢é è¨­å€¼**ï¼šåš´ç¦å»ºç«‹ã€Œæ‡¸ç©ºã€çš„å¹¾ä½•ç¯€é»ã€‚æ‰€æœ‰å¹¾ä½•ç¯€é»çš„åº§æ¨™è¼¸å…¥ï¼ˆX, Y, Zï¼‰å¿…é ˆé€£æ¥å¤–éƒ¨è¼¸å…¥ç¯€é»ã€‚
- **Code Block å¼·åˆ¶åŒ–**ï¼š
    - æ‰€æœ‰æ•¸å€¼ï¼ˆNumberï¼‰å¿…é ˆé€é `Code Block` (æŒ‡ä»¤ä¸­ç¨±ç‚º `Number`) ç¯€é»ç”¢ç”Ÿã€‚
    - æ•¸å€¼å…§å®¹å¿…é ˆä»¥åˆ†è™Ÿçµå°¾ï¼ˆä¾‹å¦‚ `10;`ï¼‰ã€‚
- **å¯è®€æ€§ä½ˆå±€**ï¼šè¼¸å…¥ç¯€é»æ‡‰ä½æ–¼å¹¾ä½•ç¯€é»çš„å·¦å´ï¼Œä¸¦ä¿æŒé©ç•¶çš„ Y è»¸é–“è·ï¼ˆå»ºè­°é–“éš” 100 å–®ä½ï¼‰ï¼Œé¿å…ç¯€é»åœ¨ç•«é¢ä¸Šé‡ç–Šã€‚

## 4. é€£ç·šèˆ‡é©—è­‰æº–å‰‡ (Connection & Verification)
- **ä¸‰åŸ å¿…é€£**ï¼šå°æ–¼ 3D é»ï¼Œ`x`, `y`, `z` ä¸‰å€‹ Port (0, 1, 2) å¿…é ˆå…¨éƒ¨å»ºç«‹é€£ç·šã€‚
- **åŸ ä½ç´¢å¼•æª¢æŸ¥**ï¼šåœ¨ç™¼é€æŒ‡ä»¤å‰ï¼Œå¿…é ˆå°ç…§ `common_nodes.json` ç¢ºèªæ¯å€‹ Port çš„ Index æ˜¯å¦æ­£ç¢ºã€‚
- **è‡ªæˆ‘å¯©æŸ¥å¾ªç’°**ï¼š
    1. ç”Ÿæˆ JSON æŒ‡ä»¤ã€‚
    2. æª¢æŸ¥ï¼šXYZ æ˜¯å¦éƒ½æœ‰å°æ‡‰çš„ Code Blockï¼Ÿ
    3. æª¢æŸ¥ï¼šé€£ç·šæ˜¯å¦æŒ‡å‘äº†æ­£ç¢ºçš„åŸ ä½ç´¢å¼•ï¼Ÿ
    4. åŸ·è¡Œä¸¦ä½¿ç”¨ `analyze_workspace` æª¢æŸ¥æ˜¯å¦æœ‰è­¦å‘Šã€‚

## 5. æ•…éšœæ’é™¤è¦å‰‡
- è‹¥ `analyze_workspace` å›å‚³ `Warning` æˆ–é»é‡ç–Šï¼ŒAI å¿…é ˆç«‹å³åˆ†ææ˜¯å¦æœ‰ Port æœªæ­£ç¢ºçµ¦å€¼ï¼Œä¸¦ç¦æ­¢åœ¨æœªä¿®æ­£é‚è¼¯çš„æƒ…æ³ä¸‹é‡è¤‡ç™¼é€ç›¸åŒæŒ‡ä»¤ã€‚
