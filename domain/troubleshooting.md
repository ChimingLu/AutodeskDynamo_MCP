---
description: Dynamo MCP æ•…éšœæ’é™¤æ¨™æº–æ“ä½œç¨‹åº (SOP)
version: 1.0
last_updated: 2026-01-11
---

# Dynamo MCP æ•…éšœæ’é™¤ SOP

> **ç›®çš„**ï¼šæä¾›çµæ§‹åŒ–çš„æ•…éšœè¨ºæ–·èˆ‡ä¿®å¾©æµç¨‹ï¼Œç¢ºä¿ AI èˆ‡ä½¿ç”¨è€…èƒ½å¿«é€Ÿè§£æ±ºé€£ç·šèˆ‡æ“ä½œå•é¡Œã€‚

---

## ğŸ”´ é€£ç·šå¤±æ•—

### ç—‡ç‹€
- `analyze_workspace` å›å‚³ `Connection Refused`
- AI é¡¯ç¤ºã€ŒâŒ å¤±æ•—: Dynamo ç›£è½å™¨æœªå•Ÿå‹•ã€
- HTTP è«‹æ±‚è¶…æ™‚

### è¨ºæ–·æ­¥é©Ÿ

#### 1. æª¢æŸ¥ Dynamo æ˜¯å¦é–‹å•Ÿ
```
Q: Dynamo è¦–çª—æ˜¯å¦é–‹å•Ÿï¼Ÿ
â””â”€ NO â†’ è«‹é–‹å•Ÿ Dynamoï¼ˆSandbox æˆ– Revit å…§å»ºï¼‰
â””â”€ YES â†’ ç¹¼çºŒä¸‹ä¸€æ­¥
```

#### 2. æª¢æŸ¥ StartMCPServer ç¯€é»
```
Q: å·¥ä½œå€æ˜¯å¦å·²æ”¾ç½® MCPControls.StartMCPServer ç¯€é»ï¼Ÿ
â””â”€ NO â†’ å¾ç¯€é»åº«æœå°‹ä¸¦æ”¾ç½®è©²ç¯€é»
â””â”€ YES â†’ æª¢æŸ¥ç¯€é»ç‹€æ…‹æ˜¯å¦é¡¯ç¤º "Active"
```

#### 3. æª¢æŸ¥é€£æ¥åŸ ä½”ç”¨
**æ‰‹å‹•æª¢æ¸¬**ï¼ˆPowerShellï¼‰ï¼š
```powershell
netstat -ano | findstr :5050
```

**é æœŸçµæœ**ï¼š
- è‹¥é¡¯ç¤º `LISTENING` ä¸” PID å°æ‡‰ Dynamo ç¨‹åº â†’ æ­£å¸¸
- è‹¥ç„¡ä»»ä½•çµæœ â†’ StartMCPServer ç¯€é»æœªæˆåŠŸå•Ÿå‹•
- è‹¥ PID å°æ‡‰å…¶ä»–ç¨‹åº â†’ Port è¢«ä½”ç”¨ï¼Œéœ€çµ‚æ­¢è©²ç¨‹åº

#### 4. å¼·åˆ¶é‡å•Ÿç›£è½å™¨
**ä¿®å¾© SOP**ï¼š
1. æ”¾ç½® `MCPControls.StopMCPServer` ç¯€é»
2. ç¢ºèªé¡¯ç¤º "successfully stopped"
3. **åˆªé™¤** Stop ç¯€é»
4. é‡æ–°æ”¾ç½® `StartMCPServer` ç¯€é»
5. åŸ·è¡Œ `analyze_workspace` é©—è­‰

---

## ğŸ‘» å¹½éˆé€£ç·š

### ç—‡ç‹€
- AI é¡¯ç¤ºæ“ä½œæˆåŠŸï¼ˆHTTP 200ï¼‰ï¼Œä½† **Dynamo ç•«é¢ç„¡åæ‡‰**
- `nodeCount` é¡¯ç¤ºèˆŠè³‡æ–™ï¼Œä½†ä½¿ç”¨è€…è¡¨ç¤ºã€Œå‰›é–‹æ–°æª”æ¡ˆã€
- ä½¿ç”¨è€…å›å ±ã€Œçœ‹ä¸åˆ°ç¯€é»ã€

### ç™¼ç”Ÿå ´æ™¯
- åœ¨ **Revit ä¸­é‡æ–°é–‹å•Ÿ Dynamo è¦–çª—**ï¼ˆæœªé—œé–‰ Revitï¼‰
- Dynamo çª—å£å´©æ½°å¾Œé‡å•Ÿ
- å¤šå€‹ Dynamo å¯¦ä¾‹åŒæ™‚é‹è¡Œ

### è¨ºæ–·æ–¹æ³•

#### è‡ªå‹•åµæ¸¬
```
IF analyze_workspace.nodeCount > 1 
   AND ä½¿ç”¨è€…å›å ±ã€Œç©ºç™½æª”æ¡ˆã€æˆ–ã€Œçœ‹ä¸åˆ°æ±è¥¿ã€
THEN åˆ¤å®šç‚ºå¹½éˆé€£ç·š
```

#### æ‰‹å‹•ç¢ºèª
1. åŸ·è¡Œ `analyze_workspace`
2. æŸ¥çœ‹å›å‚³çš„ `sessionId`
3. å°æ¯”å‰æ¬¡è¨˜éŒ„çš„ `sessionId`
4. è‹¥ä¸ä¸€è‡´ â†’ ç¢ºèªç‚ºæ–°å¯¦ä¾‹ï¼Œä½†é€£ç·šåˆ°èˆŠ Session

### ä¿®å¾©æµç¨‹

**æ¨™æº– SOP**ï¼ˆå¼·åˆ¶åŸ·è¡Œï¼‰ï¼š
```
1. StopMCPServer
   â””â”€ æ”¾ç½® MCPControls.StopMCPServer ç¯€é»
   â””â”€ ç¢ºèªé¡¯ç¤º "successfully stopped"

2. æ¸…ç†ç¯€é»
   â””â”€ **å¿…é ˆæ‰‹å‹•åˆªé™¤** Stop ç¯€é»
   â””â”€ è‹¥æœ‰å…¶ä»–èˆŠç¯€é»ï¼Œå»ºè­°ä¸€ä½µæ¸…é™¤

3. é‡æ–°å»ºç«‹é€£ç·š
   â””â”€ æ”¾ç½® MCPControls.StartMCPServer ç¯€é»
   â””â”€ ç¢ºèªé¡¯ç¤º "Active"

4. é©—è­‰ä¿®å¾©
   â””â”€ åŸ·è¡Œ analyze_workspace
   â””â”€ ç¢ºèª nodeCount æ¢å¾©ç‚º 1
   â””â”€ ç¢ºèª sessionId å·²æ›´æ–°
```

### é é˜²æªæ–½
- æ¯æ¬¡å°è©±é–‹å§‹æ™‚ï¼Œå¼·åˆ¶åŸ·è¡Œ [`startup_checklist.md`](startup_checklist.md)
- è‹¥ Dynamo è¦–çª—è¢«é‡é–‹ï¼Œ**å¿…é ˆ**å¼•å°ä½¿ç”¨è€…åŸ·è¡Œå®Œæ•´ä¿®å¾©æµç¨‹
- é—œé–‰ Dynamo å‰ï¼Œå»ºè­°å…ˆåŸ·è¡Œ `StopMCPServer`

---

## âš ï¸ å¤šç¨‹åºè¡çª

### ç—‡ç‹€
- `analyze_workspace` å›å‚³è­¦å‘Šï¼šã€Œâš ï¸ åš´é‡è­¦å‘Š: åµæ¸¬åˆ°å¤šå€‹ Dynamo/Revit ç¨‹åºã€
- æŒ‡ä»¤ç™¼é€æˆåŠŸï¼Œä½†ä¸ç¢ºå®šå“ªå€‹ Dynamo æ¥æ”¶åˆ°

### è¨ºæ–·æ­¥é©Ÿ

#### 1. æª¢æŸ¥ç³»çµ±ç¨‹åº
**PowerShell**ï¼š
```powershell
tasklist | findstr /i "DynamoSandbox Revit"
```

**é æœŸçµæœ**ï¼š
- åƒ…ä¸€å€‹ `DynamoSandbox.exe` æˆ– `Revit.exe` ç¨‹åº â†’ æ­£å¸¸
- å¤šå€‹ç¨‹åº â†’ ç¢ºèªç‚ºå¤šç¨‹åºè¡çª

#### 2. è­˜åˆ¥é€£ç·šç›®æ¨™
- åŸ·è¡Œ `analyze_workspace`
- æŸ¥çœ‹å›å‚³çš„ `processId`
- å°ç…§ `tasklist` çµæœï¼Œç¢ºèªç•¶å‰é€£ç·šè‡³å“ªå€‹ç¨‹åº

### ä¿®å¾©æµç¨‹

**å¼·åˆ¶çµ‚æ­¢æ³•**ï¼ˆæ¨è–¦ï¼‰ï¼š
```
1. å„²å­˜æ‰€æœ‰ Dynamo æª”æ¡ˆ
2. é—œé–‰æ‰€æœ‰ Dynamo èˆ‡ Revit è¦–çª—
3. å·¥ä½œç®¡ç†å“¡ â†’ å¼·åˆ¶çµæŸæ‰€æœ‰ Dynamo/Revit ç¨‹åº
4. é‡æ–°å•Ÿå‹• Dynamo
5. æ”¾ç½® StartMCPServer ç¯€é»
6. åŸ·è¡Œ analyze_workspace é©—è­‰
```

**é¸æ“‡æ€§çµ‚æ­¢æ³•**ï¼ˆé€²éšï¼‰ï¼š
```
1. è­˜åˆ¥ç›®æ¨™ PIDï¼ˆé€é analyze_workspace.processIdï¼‰
2. çµ‚æ­¢éç›®æ¨™ PID çš„å…¶ä»–ç¨‹åº
3. åŸ·è¡Œ analyze_workspace ç¢ºèªè­¦å‘Šæ¶ˆå¤±
```

---

## ğŸ”§ ç¯€é»å‰µå»ºå¤±æ•—

### ç—‡ç‹€
- `execute_dynamo_instructions` å›å‚³æˆåŠŸï¼Œä½†ç¯€é»æœªå‡ºç¾
- å›å‚³éŒ¯èª¤è¨Šæ¯ï¼šã€ŒNode creation failedã€
- ç¯€é»ä½ç½®éŒ¯èª¤æˆ–åƒæ•¸ç¼ºå¤±

### å¸¸è¦‹åŸå› 

#### 1. ä½¿ç”¨éŒ¯èª¤çš„ç¯€é»åç¨±
**éŒ¯èª¤ç¯„ä¾‹**ï¼š
```json
{"name": "Point.ByCoordinates"}  // âŒ ç„¡æ³•ç›´æ¥å‰µå»º
```

**æ­£ç¢ºæ–¹æ³•**ï¼š
```json
{
  "name": "Number",
  "value": "Point.ByCoordinates(0, 0, 0);"
}
```

**åƒè€ƒæ–‡ä»¶**ï¼š[`GEMINI.md#ç¶“é©—æç…‰`](../GEMINI.md#æ ¸å¿ƒæ•™è¨“-1code-block-æ˜¯å”¯ä¸€å¯é çš„ç¯€é»å‰µå»ºæ–¹æ³•)

#### 2. åˆ†æ•£å¼ç¯€é» + é€£ç·šåæ¨¡å¼
**éŒ¯èª¤åšæ³•**ï¼šè©¦åœ–å‰µå»ºå¤šå€‹ `Number` ç¯€é»ä¸¦é€é `connectors` é€£æ¥

**è§£æ±ºæ–¹æ¡ˆ**ï¼šå°‡æ‰€æœ‰åƒæ•¸å…§åµŒæ–¼å–®ä¸€ Code Block çš„ DesignScript ä¸­

#### 3. DesignScript èªæ³•éŒ¯èª¤
**å¸¸è¦‹éŒ¯èª¤**ï¼š
- ç¼ºå°‘åˆ†è™Ÿ `;`
- åƒæ•¸é¡å‹éŒ¯èª¤ï¼ˆå­—ä¸²æœªåŠ å¼•è™Ÿï¼‰
- Overload é¸æ“‡éŒ¯èª¤ï¼ˆ2D vs 3Dï¼‰

**è¨ºæ–·æ–¹æ³•**ï¼š
1. æª¢æŸ¥ `value` æ¬„ä½æ˜¯å¦ä»¥ `;` çµå°¾
2. åœ¨ Dynamo å…§æ‰‹å‹•å»ºç«‹ Code Block æ¸¬è©¦èªæ³•
3. æŸ¥è©¢ `DynamoViewExtension/common_nodes.json` ç¢ºèªç¯€é»ç°½å

---

## ğŸ“Œ é€šç”¨æ•…éšœæ’é™¤æµç¨‹

```mermaid
graph TD
    A[é‡åˆ°å•é¡Œ] --> B{èƒ½å¦é€£ç·š?}
    B -->|NO| C[æª¢æŸ¥ StartMCPServer ç¯€é»]
    B -->|YES| D{æ“ä½œæœ‰åæ‡‰?}
    D -->|NO| E[å¹½éˆé€£ç·šæª¢æ¸¬]
    D -->|YES| F{çµæœæ­£ç¢º?}
    F -->|NO| G[æª¢æŸ¥ç¯€é»å‰µå»ºæ–¹æ³•]
    F -->|YES| H[æ­£å¸¸é‹ä½œ]
    
    C --> I{å·²æ”¾ç½®?}
    I -->|NO| J[æ”¾ç½®ç¯€é»]
    I -->|YES| K[å¼·åˆ¶é‡å•Ÿç›£è½å™¨]
    
    E --> L[åŸ·è¡Œå¹½éˆé€£ç·šä¿®å¾© SOP]
    G --> M[åƒè€ƒ GEMINI.md ç¶“é©—æç…‰]
```

---

## ğŸ”— ç›¸é—œæ–‡ä»¶

- **å•Ÿå‹•æª¢æŸ¥**ï¼š[`startup_checklist.md`](startup_checklist.md)
- **å¿«é€Ÿåƒè€ƒ**ï¼š[`QUICK_REFERENCE.md`](../QUICK_REFERENCE.md)
- **ç¯€é»å‰µå»ºè¦ç¯„**ï¼š[`GEMINI.md#ç¶“é©—æç…‰`](../GEMINI.md)
- **æŠ€è¡“å¯¦ä½œ**ï¼š`DynamoViewExtension/src/SimpleHttpServer.cs`

---

## ğŸ“ å‡ç´šè·¯å¾‘

è‹¥ä¸Šè¿° SOP ç„¡æ³•è§£æ±ºå•é¡Œï¼Œè«‹ï¼š

1. **æª¢æŸ¥æ—¥èªŒ**ï¼š
   - `DynamoViewExtension` æ—¥èªŒä½ç½®ï¼š`%AppData%\Dynamo\[Version]\MCPListener_*.log`
   - æŸ¥æ‰¾éŒ¯èª¤è¨Šæ¯æˆ–å †ç–Šè¿½è¹¤

2. **æä¾›è¨ºæ–·è³‡è¨Š**ï¼š
   - `analyze_workspace` å®Œæ•´å›æ‡‰
   - Dynamo ç‰ˆæœ¬èˆ‡ Revit ç‰ˆæœ¬
   - é‡ç¾æ­¥é©Ÿ

3. **ç¤¾ç¾¤æ”¯æ´**ï¼š
   - æäº¤ Issue è‡³å°ˆæ¡ˆ GitHub
   - é™„ä¸Šæ—¥èªŒèˆ‡è¨ºæ–·è³‡è¨Š
