ç‚ºäº†ç¢ºä¿ AI åœ¨æ§åˆ¶ Autodesk Dynamo æ™‚ä¸ç™¼ç”Ÿä½ç´šéŒ¯èª¤ï¼ˆå¦‚é»åº§æ¨™é‡ç–Šã€èª¤ç”¨ 2D ç¯€é»ç­‰ï¼‰ï¼Œç‰¹è¨‚å®šæ­¤è¦ç¯„ã€‚**AI åœ¨åŸ·è¡Œä»»ä½•ç¹ªåœ–æŒ‡ä»¤å‰å¿…é ˆæª¢æŸ¥æ­¤è¦ç¯„ã€‚**


## ğŸ“‚ å°ˆæ¡ˆçµæ§‹

- **`bridge/`**: **[æ ¸å¿ƒæ©‹æ¥]** å­˜æ”¾é€šè¨Šèˆ‡å·¥å…·é‚è¼¯ã€‚
  - `python/server.py`: ä¸»è¦ MCP è™•ç†å™¨èˆ‡ WebSocket ä¼ºæœå™¨ã€‚
  - `node/index.js`: Stdio-to-WS æ©‹æ¥å™¨ï¼ˆä¾› AI Client èª¿ç”¨ï¼‰ã€‚
- **`mcp_config.json`**: ä¸­å¿ƒåŒ–é…ç½®æ–‡ä»¶ã€‚
- `DynamoViewExtension/`: C# åŸå§‹ç¢¼ï¼ŒåŒ…å« `common_nodes.json` (ç¯€é»ç°½åå®šç¾©)ã€‚
- `DynamoScripts/`: è…³æœ¬åº«ï¼Œå­˜æ”¾ç¶“éæ¸¬è©¦çš„å¸¸ç”¨ Dynamo JSON åœ–è¡¨å®šç¾©ã€‚
- `domain/`: **[SOP çŸ¥è­˜åº«]** æ¨™æº–æ“ä½œç¨‹åºèˆ‡æ•…éšœæ’é™¤æŒ‡å—ã€‚
- `tests/`: é©—è­‰ã€æ•ˆèƒ½æ¸¬è©¦ã€åŠŸèƒ½æª¢æŸ¥ã€‚
- `examples/`: æä¾›çµ¦é–‹ç™¼è€…çš„åŸºæº–ç¯„ä¾‹ã€‚
- `image/`: **[è¦–è¦ºåŒ–ç”¢å‡º]** å­˜æ”¾ `/image` æŒ‡ä»¤ç”¢å‡ºçš„è…³æœ¬åˆ†æåœ–è¡¨èˆ‡æŠ€è¡“æ–‡æª”ã€‚
- `deploy.ps1`: **[ä¸€éµéƒ¨ç½²]** ç·¨è­¯ä¸¦å®‰è£æ’ä»¶è‡³ Dynamo å¥—ä»¶è·¯å¾‘ã€‚
- **`GEMINI.md`**: **[AI å¿…è®€]** æŒ‡å°è¦ç¯„ã€‚
- **`QUICK_REFERENCE.md`**: **[å¿«é€Ÿåƒè€ƒ]** å¸¸ç”¨ç¯„ä¾‹ã€‚

## ğŸ§  AI å”ä½œæŒ‡ä»¤

æ­¤å°ˆæ¡ˆæ¡ç”¨ã€Œä¸Šä¸‹æ–‡å·¥ç¨‹ (Context Engineering)ã€ç­–ç•¥ï¼Œå€åˆ† **é«˜éšè¦å‰‡ (Rules)** èˆ‡ **å…·é«”è¦æ ¼ (Specs)**ã€‚AI åŠ©æ‰‹å¿…é ˆéµå¾ªä»¥ä¸‹æŒ‡ä»¤èˆ‡è¡Œç‚ºæ¨¡å¼ï¼š

### 1. æŒ‡ä»¤å®šç¾©èˆ‡è¡Œç‚ºæ¨¡å¼
| æŒ‡ä»¤ | è¡Œç‚ºè¦ç¯„ (AI å¿…é ˆåŸ·è¡Œçš„å‹•ä½œ) |
| :--- | :--- |
| **`/lessons`** | **æ™ºæ…§æç…‰**ï¼šå¾æˆåŠŸå°è©±ä¸­æå–ã€Œé«˜éšè¦å‰‡æˆ–é¿å‘ç¶“é©—ã€,ä¸¦ä»¥ **Append (è¿½åŠ )** æ–¹å¼å¯«å…¥æ­¤ `GEMINI.md` æœ«å°¾ã€‚åš´ç¦åªè¨˜ä»£ç¢¼ç´°ç¯€ã€‚ |
| **`/domain`** | **SOP è½‰æ›**ï¼šå°‡æˆåŠŸçš„å°è©±å·¥ä½œæµç¨‹è½‰æ›ç‚ºæ¨™æº– SOP æ ¼å¼çš„ `domain/*.md` æª”æ¡ˆã€‚æ­¥é©Ÿï¼š(1) ç¢ºèªå°è±¡ (2) æå–å·¥å…·å’Œæ­¥é©Ÿ (3) ç”¨ YAML frontmatter + MD æ ¼å¼æ’°å¯« (4) å„²å­˜è‡³ `domain/` (5) æ›´æ–°è§¸ç™¼è¡¨ã€‚ |
| **`/review`** | **æ†²æ³•å¯©è¨ˆ**ï¼šæª¢æŸ¥ `GEMINI.md` æ˜¯å¦éæ–¼è‚¥å¤§ã€‚ç•¶è¦å‰‡è¶…é 100 è¡Œï¼Œæè­°å°‡å…·é«”çš„ã€Œè¦æ ¼æˆ–æ¡ˆä¾‹ã€é·ç§»è‡³ `domain/` æˆ– `docs/`ã€‚ |
| **`/explain`** | **è¦–è¦ºåŒ–è§£æ§‹**ï¼šè§£é‡‹è¤‡é›œæ¦‚å¿µæ™‚ï¼Œ**å¼·åˆ¶ä½¿ç”¨** Markdown è¡¨æ ¼ã€ASCII æµç¨‹åœ–æˆ– Mermaid åœ–è¡¨ã€‚åš´ç¦æä¾›å†—é•·çš„æ–‡å­—ç‰†ã€‚ |
| **`/image`** | **è…³æœ¬è¦–è¦ºåŒ–åˆ†æ**ï¼šä¾ç…§ [`domain/visual_analysis_workflow.md`](domain/visual_analysis_workflow.md) ä¹‹æ¨™æº–æµç¨‹åŸ·è¡Œã€‚è‡ªå‹•åµæ¸¬ç•¶å‰å·¥ä½œå€æª”åï¼Œè‹¥æœªå­˜æª”å‰‡æç¤ºä½¿ç”¨è€…ã€‚ç”¢å‡ºåŒ…å«ï¼š(1) æŠ€è¡“æ–‡æª” (2) è¦–è¦ºåŒ–å„€è¡¨æ¿åœ–ç‰‡ (**å¼·åˆ¶ 16:9 Cinematic Landscape æ ¼å¼**)ã€‚æ‰€æœ‰ç”¢å‡ºé ˆå­˜è‡³ `image/` è³‡æ–™å¤¾ã€‚ |


### 2. æ ¸å¿ƒè¡Œç‚ºç¾©å‹™ (ä¸éœ€è¦æŒ‡ä»¤å³å¯è§¸ç™¼)
- **è‡ªå‹•é æª¢ (Auto-Precheck)**ï¼šåœ¨é–‹å§‹ä»»ä½•ä»»å‹™å‰ï¼Œæˆ‘ **å¿…é ˆä¸»å‹•** æª¢ç´¢ `domain/`ã€`scripts/` ä»¥åŠ `GEMINI.md`ã€‚å¦‚æœå·²æœ‰å…ˆå‰æˆåŠŸçš„ç­–ç•¥ï¼Œå¿…é ˆå„ªå…ˆåƒè€ƒï¼Œåš´ç¦é‡è¤‡æ’°å¯«é¡ä¼¼é‚è¼¯çš„ JSONã€PYã€‚
- **è¦æ ¼é©…å‹• (SDD)**ï¼šé‡å¤§è®Šæ›´å‰æ‡‰å…ˆæ›´æ–° `domain/` ä¸­çš„ MD æ–‡ä»¶ï¼ˆè¦æ ¼ï¼‰ï¼Œè€Œéç›´æ¥ä¿®æ”¹ç¨‹å¼ç¢¼ã€‚
- **æ–‡ä»¶åŒæ­¥ç¾©å‹™ (Documentation Sync)**ï¼šæ›´æ–° `README.md` æ™‚ï¼Œ**å¿…é ˆåŒæ­¥æ›´æ–°** `README_EN.md`ï¼Œç¢ºä¿ä¸­è‹±æ–‡ç‰ˆæœ¬å…§å®¹ä¸€è‡´ã€‚æ­¤è¦ç¯„é©ç”¨æ–¼æ‰€æœ‰æ¶‰åŠ README çš„ä¿®æ”¹ã€æ–°å¢æˆ–åˆªé™¤æ“ä½œã€‚

### ğŸ“‚ è…³æœ¬èˆ‡çŸ¥è­˜çµ„ç¹”è¦ç¯„
- **`domain/`**: å­˜æ”¾é•·æœŸæ¥­å‹™é‚è¼¯ã€æ³•è¦åˆ†æç­–ç•¥ã€æˆåŠŸçš„ AI å”ä½œç¶“é©— (MD æ ¼å¼)ã€‚
- **`DynamoScripts/`**: å­˜æ”¾ç©©å®šçš„åº•å±¤æ ¸å¿ƒ MCP å·¥å…· (JSON)ã€‚
- **`examples/`**: å­˜æ”¾åƒæ•¸åŒ–ã€å¯é‡è¤‡èª¿ç”¨çš„ç©©å®šå·¥ä½œæµè…³æœ¬(PY)ã€‚
- **`tests/`**: å­˜æ”¾ä»»å‹™å°å‘ã€ä¸€æ¬¡æ€§æˆ–é™¤éŒ¯ç”¨çš„é›œé¤˜è…³æœ¬ã€‚
- **`image/`**: å­˜æ”¾ `/image` æŒ‡ä»¤ç”¢å‡ºçš„ Dynamo è…³æœ¬è¦–è¦ºåŒ–åˆ†æçµæœï¼ˆåŒ…å« Mermaid åœ–è¡¨ã€æŠ€è¡“æ–‡æª”ï¼‰ã€‚


## 0. å•Ÿå‹•èˆ‡ç‹€æ…‹æª¢æŸ¥ (Startup & Status Check)

> **ğŸ“‹ å®Œæ•´æª¢æŸ¥æµç¨‹è«‹åƒè€ƒ**ï¼š[`domain/startup_checklist.md`](domain/startup_checklist.md)

- **å¼·åˆ¶åŸ·è¡Œåˆ†æ**ï¼šAI åœ¨é€²è¡Œä»»ä½•å¯¦è³ªä½œæ¥­å‰ï¼Œ**å¿…é ˆ**å…ˆåŸ·è¡Œ `analyze_workspace` å·¥å…·ã€‚åœ¨ WebSocket æ–¹æ¡ˆä¸‹ï¼Œé€™å°‡é©—è­‰æŒä¹…é€£ç·šæ˜¯å¦å»ºç«‹ã€‚
- **å¹½éˆé€£ç·šå¾¹åº•ä¿®å¾©**ï¼š
    - WebSocket æ–¹æ¡ˆé€éæŒä¹…æ€§ TCP é€£ç·šè§£æ±ºäº†å¹½éˆé€£ç·šå•é¡Œã€‚è‹¥é€£ç·šä¸­æ–·ï¼Œä¼ºæœå™¨æœƒç«‹å³æ„ŸçŸ¥ä¸¦æ¸…é™¤ Sessionã€‚
- **å¼·åˆ¶å›å ±**ï¼šæ¯æ¬¡é€£ç·šå»ºç«‹æˆ–ç’°å¢ƒè®Šå‹•å¾Œï¼ŒAI æœƒæ”¶åˆ°ï¼š
    - `Workspace FileName`: ç¢ºèªç•¶å‰é–‹å•Ÿçš„æª”æ¡ˆã€‚

**ç›¸é—œæ–‡ä»¶**ï¼š
- ğŸ“‹ [å•Ÿå‹•æª¢æŸ¥æ¸…å–®](domain/startup_checklist.md) - æ¨™æº–åŒ– AI åˆå§‹åŒ–æµç¨‹
- ğŸ”§ [æ•…éšœæ’é™¤ SOP](domain/troubleshooting.md) - é€£ç·šå¤±æ•—ã€å¹½éˆé€£ç·šç­‰å•é¡Œè§£æ±ºæ–¹æ¡ˆ
- ğŸ¨ [è¦–è¦ºåŒ–åˆ†æ SOP](domain/visual_analysis_workflow.md) - `/image` æŒ‡ä»¤çš„æ¨™æº–åŸ·è¡Œæµç¨‹


---

## ğŸ“š ç¶“é©—æç…‰èˆ‡é¿å‘æŒ‡å— (Lessons Learned)

> **æœ€å¾Œæ›´æ–°**: 2026-01-11 09:52 (GMT+8)  
> **æç…‰ä¾†æº**: å¤šæ¬¡ Dynamo ç¯€é»å‰µå»ºå¤±æ•—èˆ‡æˆåŠŸæ¡ˆä¾‹çš„ç¸½çµ

### ğŸ¯ æ ¸å¿ƒæ•™è¨“ #1ï¼šç¯€é»å‰µå»ºç­–ç•¥ (Node Creation Strategy)

> **æœ€å¾Œæ›´æ–°**: 2026-01-19  
> **é‡è¦è®Šæ›´**: å…è¨±ä½¿ç”¨åŸç”Ÿç¯€é»æˆ– Code Blockï¼Œæ ¹æ“šæƒ…å¢ƒé¸æ“‡æœ€ä½³æ–¹æ¡ˆã€‚

**æ ¸å¿ƒè¡Œç‚ºè¦ç¯„**ï¼š
- âœ… **ç°¡å–®å¹¾ä½•**: ä½¿ç”¨å–®ä¸€ Code Blockï¼ˆä¸€æ¬¡æ€§è¨ˆç®—ï¼‰
- âœ… **è¤‡é›œæµç¨‹**: ä½¿ç”¨åŸç”Ÿç¯€é» + é€£ç·šï¼ˆè¦–è¦ºåŒ–é‚è¼¯ï¼‰
- âœ… **å¿…é ˆä½¿ç”¨æ­£ç¢ºçš„ JSON æ ¼å¼**ï¼š`"name"` æ¬„ä½ + ç›´æ¥åº§æ¨™å€¼

---

#### ğŸ›¤ï¸ é¸é … A: Code Block å…§åµŒæ¨¡å¼ï¼ˆç°¡å–®å¹¾ä½•ï¼‰

**é©ç”¨æƒ…å¢ƒ**ï¼š
- å–®ä¸€å¹¾ä½•ç‰©ä»¶ï¼ˆä¸€æ¢ç·šã€ä¸€å€‹é»ï¼‰
- ä¸éœ€è¦è¦–è¦ºåŒ–ä¸­é–“æ­¥é©Ÿ
- å¿«é€ŸåŸå‹

**å¯¦æˆ°æ¨¡æ¿**:
```json
{
  "nodes": [{
    "id": "line_01",
    "name": "Number",
    "value": "Line.ByStartPointEndPoint(Point.ByCoordinates(0,0,0), Point.ByCoordinates(100,100,100));",
    "x": 300, "y": 300
  }],
  "connectors": []
}
```

**å„ªé»**: ç°¡æ½”ã€æˆåŠŸç‡ 100%  
**ç¼ºé»**: ç„¡æ³•è¦–è¦ºåŒ–æµç¨‹

---

#### ğŸ›¤ï¸ é¸é … B: åŸç”Ÿç¯€é»æ¨¡å¼ï¼ˆè¤‡é›œæµç¨‹ï¼‰

**é©ç”¨æƒ…å¢ƒ**ï¼š
- éœ€è¦è¦–è¦ºåŒ–ä¸­é–“æ­¥é©Ÿ
- å¤šå€‹ç¯€é»çµ„æˆçš„æµç¨‹
- éœ€è¦èª¿è©¦æˆ–ä¿®æ”¹åƒæ•¸

**å¯¦æˆ°æ¨¡æ¿**:
```json
{
  "nodes": [
    {"id": "num_x", "name": "Number", "value": "0", "x": 0, "y": 0},
    {"id": "num_y", "name": "Number", "value": "0", "x": 0, "y": 50},
    {"id": "num_z", "name": "Number", "value": "0", "x": 0, "y": 100},
    {"id": "pt1", "name": "Point.ByCoordinates", "x": 300, "y": 50}
  ],
  "connectors": [
    {"from": "num_x", "to": "pt1", "fromIndex": 0, "toIndex": 0},
    {"from": "num_y", "to": "pt1", "fromIndex": 0, "toIndex": 1},
    {"from": "num_z", "to": "pt1", "fromIndex": 0, "toIndex": 2}
  ]
}
```

**é—œéµæ ¼å¼è¦æ±‚** âš ï¸ï¼š
1. **å¿…é ˆä½¿ç”¨ `"name"` æ¬„ä½** (ä¸æ˜¯ `"type"`)
2. **åº§æ¨™ç›´æ¥å¯«åœ¨ç¯€é»ä¸­** (ä¸è¦ç”¨ `"inputs"` ç‰©ä»¶)
3. **åƒæ•¸å€¼ç”¨ Number ç¯€é» + connectors**

**å„ªé»**: è¦–è¦ºåŒ–æ¸…æ™°ã€æ˜“æ–¼èª¿è©¦  
**ç¼ºé»**: JSON è¼ƒé•·

---

### âš ï¸ æ ¸å¿ƒæ•™è¨“ #3ï¼šOverload é™·é˜±èˆ‡å¼·åˆ¶ 3D ç­–ç•¥

**ç—‡ç‹€**ï¼š  
`Point.ByCoordinates` è¢«èª¤åˆ¤ç‚º 2D ç‰ˆæœ¬ï¼Œå°è‡´ Z åº§æ¨™è¢«å¿½ç•¥ã€‚

**è¨ºæ–·æ–¹æ³•**ï¼š
1. æª¢æŸ¥ `common_nodes.json` æ˜¯å¦å­˜åœ¨å¤šå€‹ Overload ç‰ˆæœ¬
2. è‹¥ `analyze_workspace` å›å ±è­¦å‘Šï¼Œæª¢æŸ¥ç¯€é»åŸ ä½æ•¸é‡

**å¼·åˆ¶ 3D è§£æ±ºæ–¹æ¡ˆ**ï¼š
```json
{
  "value": "Point.ByCoordinates(x, y, z);"
}
```
é€é Code Block æ˜ç¢ºæŒ‡å®šä¸‰å€‹åƒæ•¸ï¼Œç¹é Overload è§£æå•é¡Œã€‚

**AI è¡Œç‚ºæº–å‰‡**ï¼š
- è‹¥ç„¡æ³•ç™¾åˆ†ä¹‹ç™¾ç¢ºå®šä½¿ç”¨å“ªå€‹ Overloadï¼Œ**å¿…é ˆ**åˆ—å‡ºé¸é …ä¸¦è«‹æ±‚ä½¿ç”¨è€…ç¢ºèª
- åš´ç¦ç›²ç›®å˜—è©¦ä¸åŒç‰ˆæœ¬

---

### ğŸ” æ ¸å¿ƒæ•™è¨“ #4ï¼šå¹½éˆé€£ç·š (Ghost Listener) åµæ¸¬èˆ‡ä¿®å¾©

**å®šç¾©**ï¼š  
Revit æœªé—œé–‰ä½† Dynamo è¦–çª—è¢«é‡æ–°é–‹å•Ÿï¼Œå°è‡´ AI æŒ‡ä»¤æˆåŠŸä½†ä½¿ç”¨è€…çœ‹ä¸åˆ°çµæœã€‚

**åˆ¤å®šæº–å‰‡**ï¼š
```
IF analyze_workspace.nodeCount > 1 
   AND ä½¿ç”¨è€…å›å ±ã€Œçœ‹ä¸åˆ°ç¯€é»ã€
THEN åˆ¤å®šç‚ºå¹½éˆé€£ç·š
```

**å¼·åˆ¶ä¿®å¾©æµç¨‹**ï¼š
1. `StopMCPServer` (æ–·é–‹èˆŠé€£ç·š)
2. é‡å•Ÿ Dynamo ä»¥æ¸…é™¤æ®˜ç•™ç‹€æ…‹
3. é‡æ–°é€£ç·š

**é é˜²æªæ–½**ï¼š  
æ¯æ¬¡å°è©±é–‹å§‹æ™‚ï¼Œå¼·åˆ¶åŸ·è¡Œ `analyze_workspace` ä¸¦å›å ±ï¼š
- Workspace Name
- Node Count
- Session State (SessionId æ˜¯å¦è®Šå‹•)

---

### ğŸ“¦ æ ¸å¿ƒæ•™è¨“ #5ï¼šè…³æœ¬åº«å¾©ç”¨å„ªå…ˆæ–¼é‡æ–°ç”Ÿæˆ

**æœ€ä½³å¯¦è¸æµç¨‹**ï¼š
```mermaid
graph LR
    A[ä½¿ç”¨è€…è«‹æ±‚ç¹ªè£½åœ–å½¢] --> B{æŸ¥è©¢è…³æœ¬åº«}
    B -->|å­˜åœ¨| C[load_script_from_library]
    B -->|ä¸å­˜åœ¨| D[ç”Ÿæˆæ–° JSON]
    D --> E[åŸ·è¡ŒæˆåŠŸ?]
    E -->|æ˜¯| F[è©¢å•æ˜¯å¦ä¿å­˜]
    F --> G[save_to_library]
```

**è…³æœ¬å‘½åè¦ç¯„**ï¼š
- æè¿°æ€§åç¨±ï¼š`grid_10x10`, `basic_cube_param`
- ä¸åŒ…å«å‰¯æª”å
- å°å¯« + åº•ç·š

**åƒæ•¸åŒ–è¼‰å…¥**ï¼š
```python
# åç§» 500 å–®ä½é¿å…é‡ç–Š
json_content = mcp.load_script_from_library(
    "basic_house", 
    base_x=500, 
    base_y=0
)
```


---

### ğŸ“¸ æ ¸å¿ƒæ•™è¨“ #6ï¼š/image æŒ‡ä»¤çš„æ¨™æº–å·¥ä½œæµ

**èƒŒæ™¯å•é¡Œ**ï¼š  
AI åœ¨åŸ·è¡Œ `/image` æŒ‡ä»¤æ™‚ï¼Œæ›¾ç¶“ç„¡æ³•æ­£ç¢ºå–å¾—æª”å (é¡¯ç¤ºç‚º Home)ï¼Œä¸”è¦–è¦ºåŒ–æµç¨‹æœªæ¨™æº–åŒ–ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. **API ä¿®æ­£**ï¼š`DynamoViewExtension` å¿…é ˆå›å‚³ `workspace.FileName` è€Œé `workspace.Name`ã€‚
2. **æ¨™æº– SOP**ï¼šåƒé–± [`domain/visual_analysis_workflow.md`](domain/visual_analysis_workflow.md)ã€‚
3. **å‘½ååŸå‰‡**ï¼šå„ªå…ˆä½¿ç”¨ `FileName` ç‚ºåŸºæº–ï¼Œé¿å…ä½¿ç”¨ `Home`ã€‚

---

### æ ¸å¿ƒæ•™è¨“ #7ï¼šåš´ç¦é‡è¤‡æ€§é–‹ç™¼èˆ‡æª”æ¡ˆäº‚ä¸Ÿ

**èƒŒæ™¯å•é¡Œ**ï¼š
å°ˆæ¡ˆä¸­å‡ºç¾å¤šå€‹åŠŸèƒ½é›·åŒçš„è…³æœ¬ï¼ˆå¦‚ `check_workspace.py`, `get_workspace_data.py` èˆ‡ `analyze_current_workspace.py` é‡è¤‡ï¼‰ï¼Œä¸”åˆ†æç”¢å‡ºçš„ JSON æª”æ¡ˆæ•£è½åœ¨æ ¹ç›®éŒ„æˆ– `tests/` ä¸­ã€‚

**å¼·åˆ¶è¦ç¯„**ï¼š
1. **ç¦æ­¢é‡è¤‡é–‹ç™¼**ï¼šåœ¨å»ºç«‹æ–°è…³æœ¬å‰ï¼Œå¿…é ˆæª¢æŸ¥ `tests/` èˆ‡ `examples/`ã€‚è‹¥å·²æœ‰é¡ä¼¼åŠŸèƒ½çš„è…³æœ¬ï¼Œæ‡‰äºˆä»¥å„ªåŒ–æˆ–åˆä½µï¼Œç¦æ­¢å»ºç«‹ `script_v2.py`ã€`check_new.py` ç­‰å†—é¤˜æª”æ¡ˆã€‚
2. **ç”¢å‡ºç‰©æ­¸ä½**ï¼š
    - **è‡¨æ™‚æ¸¬è©¦è³‡æ–™**ï¼šå¿…é ˆå­˜æ”¾æ–¼ `tests/temp/`ã€‚
    - **æ­£å¼åˆ†æå ±å‘Š/åœ–åƒ**ï¼šå¿…é ˆå­˜æ”¾æ–¼ `image/`ã€‚
    - **æ ¸å¿ƒå·¥å…·ç”¢å‡º**ï¼šåš´ç¦å‡ºç¾åœ¨æ ¹ç›®éŒ„ã€‚
3. **æ ¹ç›®éŒ„å®šé»åŒ–**ï¼šæ ¹ç›®éŒ„åƒ…å…è¨±å­˜æ”¾æ ¸å¿ƒé…ç½® (`mcp_config.json`)ã€æœå‹™å…¥å£ (`server.py`) èˆ‡æ–‡ä»¶ (`GEMINI.md`)ã€‚

---

---

### ğŸ“¦ æ ¸å¿ƒæ•™è¨“ #8ï¼šè…³æœ¬æ•´åˆèˆ‡å»é‡ç¯„ä¾‹

**èƒŒæ™¯å•é¡Œ**ï¼š  
åœ¨ `examples/` å’Œ `tests/` ä¸­ç™¼ç¾é‡è¤‡çš„ `analyze_current_workspace.py`ï¼Œé•åæ ¸å¿ƒæ•™è¨“ #7ã€‚

**æ•´åˆæ±ºç­–**ï¼š
| é …ç›® | æ±ºå®š | ç†ç”± |
|:---|:---|:---|
| **ä¿ç•™ä½ç½®** | `examples/analyze_current_workspace.py` | å±¬æ–¼å¯é‡è¤‡ä½¿ç”¨çš„æ¨™æº–å·¥å…· |
| **åŠŸèƒ½ä¾†æº** | åˆä½µ `tests/` ç‰ˆæœ¬çš„å®Œæ•´éŒ¯èª¤è™•ç† | åŒ…å« JSON è§£æã€ç·¨ç¢¼ä¿®æ­£ã€è‡ªå‹•å„²å­˜ |
| **åˆªé™¤å°è±¡** | `tests/analyze_current_workspace.py` | å·²è¢« `.gitignore` å±è”½ï¼Œå±¬è‡¨æ™‚æ¸¬è©¦ |

**æ”¹é€²é‡é»**ï¼š
1. **å®Œæ•´æ–‡æª”å­—ä¸²**ï¼šèªªæ˜è…³æœ¬ç”¨é€”ã€åŠŸèƒ½ã€ä½¿ç”¨æ–¹å¼
2. **é›™é‡ JSON è§£æ**ï¼šè™•ç† `\\` è½‰ç¾©èˆ‡ Unicode ç·¨ç¢¼å•é¡Œ
3. **è¦–è¦ºåŒ–è¼¸å‡º**ï¼šä½¿ç”¨ emoji æ¨™è¨˜ç‹€æ…‹ï¼ˆâœ… âŒ ğŸ“„ ğŸ”¢ ğŸ”—ï¼‰
4. **è‡ªå‹•å»ºç«‹ç›®éŒ„**ï¼šç¢ºä¿ `tests/temp/` å­˜åœ¨å†å¯«å…¥

**æ•´åˆå¾Œçš„é»ƒé‡‘æ¨™æº–**ï¼š
```python
# examples/analyze_current_workspace.py (118 è¡Œ)
âœ… å®Œæ•´çš„ Apache 2.0 æˆæ¬Šè²æ˜
âœ… è©³ç´°çš„ Docstring èªªæ˜
âœ… é›™é‡ JSON è§£ææ©Ÿåˆ¶ï¼ˆè™•ç†è½‰ç¾©èˆ‡ç·¨ç¢¼ï¼‰
âœ… è‡ªå‹•å„²å­˜è‡³ tests/temp/workspace_analysis.json
âœ… å‹å–„çš„ä¸­æ–‡è¼¸å‡ºèˆ‡éŒ¯èª¤è¨Šæ¯
```

---

### ğŸ›¡ï¸ è‡ªæˆ‘å¯©æŸ¥æ¸…å–® (Pre-Flight Checklist)

#### é€šç”¨æª¢æŸ¥ (æ‰€æœ‰è»Œé“)

åŸ·è¡Œä»»ä½•ç¯€é»å‰µå»ºå‰ï¼ŒAI å¿…é ˆæª¢æŸ¥ï¼š

- [ ] å·²åŸ·è¡Œ `analyze_workspace` ç¢ºèªç’°å¢ƒç‹€æ…‹
- [ ] SessionId æ˜¯å¦èˆ‡å‰æ¬¡ä¸€è‡´ (é¿å…å¹½éˆé€£ç·š)
- [ ] æ˜¯å¦æœ‰ç¾æˆè…³æœ¬å¯å¾©ç”¨ (æŸ¥è©¢ `get_script_library`)
- [ ] ç”¢å‡ºç‰©æ”¾ç½®è·¯å¾‘æ˜¯å¦ç¬¦åˆè¦ç¯„ (åš´ç¦æ”¾æ ¹ç›®éŒ„)
- [ ] å·²æ ¹æ“šæ±ºç­–çŸ©é™£é¸æ“‡é©ç•¶è»Œé“ (åƒè€ƒæ ¸å¿ƒæ•™è¨“ #1)

#### è»Œé“ A å°ˆå±¬æª¢æŸ¥

- [ ] ç¯€é»åç¨±æ˜¯å¦ç‚º `"Number"` (ä¸æ˜¯ `"Code Block"`)
- [ ] `value` æ¬„ä½ä»£ç¢¼æ˜¯å¦ä»¥ `;` çµå°¾
- [ ] è‹¥æ¶‰åŠ 3D å¹¾ä½•ï¼Œæ˜¯å¦æ˜ç¢ºæŒ‡å®š Xã€Yã€Z ä¸‰å€‹åƒæ•¸
- [ ] ä»£ç¢¼èªæ³•æ˜¯å¦ç¬¦åˆ DesignScript è¦ç¯„

**æ•…éšœè™•ç†åŸå‰‡**ï¼š
```
IF analyze_workspace å›å‚³ Warning 
THEN åœæ­¢é‡è¤‡å˜—è©¦ 
     AND åˆ†ææ ¹æœ¬åŸå›  
     AND ä¿®æ­£é‚è¼¯å¾Œå†åŸ·è¡Œ
```

---

### â›“ï¸ æ ¸å¿ƒæ•™è¨“ #10ï¼šåŸç”Ÿç¯€é»é€£ç·šèˆ‡é è¦½æ§åˆ¶ (Native Node Connections & Preview)

> **æœ€å¾Œæ›´æ–°**: 2026-01-20
> **é‡è¦ç™¼ç¾**: ç¢ºä¿åŸç”Ÿç¯€é»ã€Œç¬¬ä¸€æ¬¡å°±æˆåŠŸã€çš„ä¸‰å¤§è¦ç´ ã€‚

**1. é€£ç·šæ¬„ä½éµå¾‹**
- **éŒ¯èª¤**: `fromIndex`, `toIndex` (ç„¡æ•ˆæ¬„ä½)ã€‚
- **æ­£ç¢º**: å¿…é ˆä½¿ç”¨ **`fromPort`** èˆ‡ **`toPort`** (0-indexed)ã€‚

**2. 3D å¼·åˆ¶è½‰å‘ (Overload Control)**
- è¨±å¤šç¯€é» (å¦‚ `Point.ByCoordinates`) é è¨­ç‚º 2Dã€‚
- **è§£æ±ºæ–¹æ¡ˆ**: åœ¨ JSON ä¸­æ˜ç¢ºåŠ å…¥ `"overload": "3D"`ï¼Œç¢ºä¿ Z è»¸åŸ ä½å¯ç”¨ã€‚

**3. æ¸…æ™°åº¦æ§åˆ¶ (Preview Management)**
- **å•é¡Œ**: ä¸­é–“éç¨‹çš„å¹¾ä½•é«” (å¦‚é»ã€åŸå§‹çƒé«”) æœƒé®æ“‹æœ€çµ‚å¸ƒæ—é‹ç®—çµæœã€‚
- **è§£æ±ºæ–¹æ¡ˆ**: 
  - ä¸­é–“ç¯€é»åŠ å…¥ `"preview": false`ã€‚
  - æœ€çµ‚çµæœç¯€é»åŠ å…¥ `"preview": true`ã€‚

**åŸç”Ÿå¸ƒæ—é‹ç®—é»ƒé‡‘æ¨¡æ¿**:
```json
{
  "nodes": [
    {"id": "pt", "name": "Point.ByCoordinates", "overload": "3D", "preview": false, "x": 0, "y": 0},
    {"id": "res", "name": "Solid.Difference", "preview": true, "x": 500, "y": 0}
  ],
  "connectors": [
    {"from": "pt", "to": "res", "fromPort": 0, "toPort": 0}
  ]
}
```

---

### ğŸ“Œ ç¸½çµï¼šç•¶å‰ä¸‰å¤§ä¸å¯é•èƒŒéµå¾‹

1. **Code Block å”¯ä¸€è«–**ï¼šæ‰€æœ‰å¸¶åƒæ•¸çš„å¹¾ä½•æ“ä½œå¿…é ˆå¯«åœ¨å–®ä¸€ Code Block ä¸­ï¼ˆé™¤éä½¿ç”¨è€…æ˜ç¢ºè¦æ±‚åŸç”Ÿç¯€é»æ¸¬è©¦ï¼‰ã€‚
2. **åŸç”Ÿé€£ç·šè¦ç¯„åŒ–**ï¼šè‹¥ä½¿ç”¨åŸç”Ÿç¯€é»ï¼Œå¿…é ˆä½¿ç”¨ `fromPort`/`toPort` æ¬„ä½ä¸¦æ˜ç¢ºæŒ‡å®š `overload` èˆ‡ `preview` ç‹€æ…‹ã€‚
3. **å¼·åˆ¶ç’°å¢ƒæª¢æŸ¥**ï¼šæ¯æ¬¡æ“ä½œå‰åŸ·è¡Œ `analyze_workspace`ï¼Œåµæ¸¬å¹½éˆé€£ç·šèˆ‡ Session è®Šå‹•ã€‚

**é—œéµæ–‡ä»¶åƒè€ƒ**ï¼š
- ğŸ“˜ é›™è»Œåˆ¶è©³ç´°æŒ‡å—ï¼š[`domain/node_creation_strategy.md`](domain/node_creation_strategy.md)
- ğŸ“‹ æ¶æ§‹åˆ†æå ±å‘Šï¼š[`domain/architecture_analysis.md`](domain/architecture_analysis.md)
- ğŸ”§ ç¯€é»ç°½åå®šç¾©ï¼š`DynamoViewExtension/common_nodes.json`
- ğŸ“¦ è…³æœ¬åº«ç›®éŒ„ï¼š`DynamoScripts/*.json`
- âš¡ å¿«é€Ÿåƒè€ƒï¼š`QUICK_REFERENCE.md`

---


> **ğŸ’¡ æç¤º**ï¼šæ ¸å¿ƒæ•™è¨“ #9 (åŸç”Ÿç¯€é»è‡ªå‹•æ“´å±•çš„ä¸‰å¤§æ”¯æŸ±) å·²æ–¼ 2026-01-16 åˆä½µè‡³**æ ¸å¿ƒæ•™è¨“ #1 (é›™è»Œåˆ¶ç­–ç•¥)**ã€‚  
> å®Œæ•´æŠ€è¡“ç´°ç¯€è«‹åƒé–±ï¼š[`domain/node_creation_strategy.md`](domain/node_creation_strategy.md)


---

### ğŸ§µ æ ¸å¿ƒæ•™è¨“ #9ï¼šUI åŸ·è¡Œç·’èˆ‡ C# äº’æ“ä½œæ€§

> **ç™¼ç¾æ—¥æœŸ**: 2026-01-19
> **åš´é‡ç¨‹åº¦**: CRITICAL (å¦‚æœé•åï¼Œæœƒå°è‡´æ‰€æœ‰æŒ‡ä»¤éœé»˜å¤±æ•—)

**èƒŒæ™¯å•é¡Œ**ï¼š
Dynamo çš„æ ¸å¿ƒæ˜¯ä¸€å€‹ WPF æ‡‰ç”¨ç¨‹å¼ã€‚ç•¶æˆ‘å€‘å¾ WebSocket (èƒŒæ™¯åŸ·è¡Œç·’) æ¥æ”¶æŒ‡ä»¤ä¸¦è©¦åœ–å»ºç«‹ç¯€é»æ™‚ï¼Œæœƒè§¸ç™¼ `NotifyCollectionChanged` ç•°å¸¸ï¼Œå°è‡´ç¨‹å¼å´©æ½°æˆ–ç„¡åæ‡‰ï¼Œä½†å¤–éƒ¨ Python ç«¯å»é¡¯ç¤ºæˆåŠŸã€‚

**å¼·åˆ¶è¦ç¯„**ï¼š
ä»»ä½•æ¶‰åŠ Dynamo æ¨¡å‹ä¿®æ”¹çš„æ“ä½œ (CreateNode, MakeConnection, DeleteModel)ï¼Œ**å¿…é ˆ** åŒ…è£åœ¨ `Application.Current.Dispatcher.InvokeAsync` ä¸­ã€‚

**C# å¯¦ä½œç¯„æœ¬**ï¼š
```csharp
await System.Windows.Application.Current.Dispatcher.InvokeAsync(() => 
{
    // æ‰€æœ‰ GraphHandler çš„æ“ä½œå¿…é ˆåœ¨æ­¤é–‰åŒ…å…§åŸ·è¡Œ
    response = _handler.HandleCommand(json);
});
```

**AI Debug æŒ‡å—**ï¼š
1. è‹¥ Python é¡¯ç¤º `âœ… æˆåŠŸ` ä½† Dynamo ç•«é¢æ²’è®Šã€‚
2. æª¢æŸ¥ `DynamoMCP.log` æ˜¯å¦æœ‰ `CollectionChanged` ç›¸é—œéŒ¯èª¤ã€‚
3. è‹¥æœ‰ï¼Œå¹¾ä¹ 100% æ˜¯å› ç‚ºæ²’æœ‰åœ¨ UI åŸ·è¡Œç·’åŸ·è¡Œã€‚


